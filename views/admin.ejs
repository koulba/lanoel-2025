<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin — LANoël</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="/public/css/style.css" rel="stylesheet" />
  <style>
    body { font-family: Arial, sans-serif; background:#f8f9fa; margin:0; padding:0;}
    .container { max-width:1200px; margin:20px auto; padding:0 15px; }
    .topbar { background:#111; color:#fff; padding:12px 0; }
    .topbar .brand { font-size:1.8rem; display:inline-block; margin-left:10px; }
    .topbar nav { float:right; margin-right:10px; }
    .topbar nav a { color:#fff; margin-left:10px; text-decoration:none; padding:6px 12px; background:#333; border-radius:6px; }
    .card { background:#fff; padding:15px 20px; margin-bottom:20px; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
    h2,h3 { margin-top:0; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    table th, table td { border:1px solid #ddd; padding:8px; text-align:left; }
    .btn { padding:6px 12px; background:#111; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    .small-btn { padding:4px 8px; background:#555; color:#fff; border:none; border-radius:4px; cursor:pointer; margin-left:4px; }
    .small-btn:hover, .btn:hover { opacity:0.85; }

    /* Inline form */
    .inline-form { display:inline-block; margin:0; padding:0; }

    /* Modals */
    .modal-overlay {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:100;
    }
    .modal-overlay.active { display:flex; }
    .modal { background:#fff; padding:20px; border-radius:12px; width:90%; max-width:500px; position:relative; box-shadow:0 6px 20px rgba(0,0,0,0.2);}
    .modal .close-btn { position:absolute; top:10px; right:10px; background:#e74c3c; color:#fff; border:none; border-radius:6px; padding:2px 6px; cursor:pointer; }

    .alert { padding:10px; margin-bottom:15px; border-radius:6px; }
    .alert.success { background:#2ecc71; color:#fff; }
    .alert.error { background:#e74c3c; color:#fff; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container">
      <span class="brand">LANoël Admin</span>
      <nav>
        <span><%= user.pseudo %></span>
        <a href="/logout">Logout</a>
        <a href="/">Accueil</a>
      </nav>
      <div style="clear:both"></div>
    </div>
  </header>

  <main class="container">

    <% if(messages.success){ %>
      <div class="alert success"><%= messages.success %></div>
    <% } %>
    <% if(messages.error){ %>
      <div class="alert error"><%= messages.error %></div>
    <% } %>

    <!-- Gérer les jeux -->
    <section class="card">
      <h2>Jeux</h2>
      <form method="post" action="/admin/games" enctype="multipart/form-data">
        <input name="name" placeholder="Nom du jeu" required />
        <input name="description" placeholder="Description" />
        <input type="number" name="order_index" placeholder="Ordre" value="0" />
        <input type="file" name="image" />
        <button class="btn">Ajouter un jeu</button>
      </form>

      <table>
        <thead><tr><th>Nom</th><th>Description</th><th>Ordre</th><th>Actions</th></tr></thead>
        <tbody>
          <% games.forEach(g=>{ %>
            <tr>
              <td><%= g.name %></td>
              <td><%= g.description %></td>
              <td><%= g.order_index %></td>
              <td>
                <button class="small-btn" onclick="openModal('game-<%= g.id %>')">Modifier</button>
                <form class="inline-form" method="post" action="/admin/games/<%= g.id %>/delete" onsubmit="return confirm('Supprimer ce jeu ?');">
                  <button class="small-btn" style="background:#e74c3c">Supprimer</button>
                </form>
              </td>
            </tr>

            <!-- Modal -->
            <div class="modal-overlay" id="game-<%= g.id %>">
              <div class="modal">
                <button class="close-btn" type="button" onclick="closeModal('game-<%= g.id %>')">X</button>
                <h3>Modifier jeu</h3>
                <form method="post" action="/admin/games/<%= g.id %>/update" enctype="multipart/form-data">
                  <input name="name" value="<%= g.name %>" />
                  <input name="description" value="<%= g.description %>" />
                  <input type="number" name="order_index" value="<%= g.order_index %>" />
                  <input type="file" name="image" />
                  <button class="btn">Enregistrer</button>
                </form>
              </div>
            </div>

          <% }) %>
        </tbody>
      </table>
    </section>

    <!-- Gérer les équipes -->
    <section class="card">
      <h2>Équipes</h2>
      <form method="post" action="/admin/teams">
        <input name="name" placeholder="Nom équipe" required />
        <input name="player1_id" placeholder="Player1 ID (opt)" />
        <input name="player2_id" placeholder="Player2 ID (opt)" />
        <button class="btn">Créer équipe</button>
      </form>

      <table>
        <thead><tr><th>Nom</th><th>Player1</th><th>Player2</th><th>Actions</th></tr></thead>
        <tbody>
          <% teams.forEach(t=>{ %>
            <tr>
              <td><%= t.name %></td>
              <td><%= t.player1_id || '' %></td>
              <td><%= t.player2_id || '' %></td>
              <td>
                <button class="small-btn" onclick="openModal('team-<%= t.id %>')">Modifier</button>
                <form class="inline-form" method="post" action="/admin/teams/<%= t.id %>/delete" onsubmit="return confirm('Supprimer cette équipe ?');">
                  <button class="small-btn" style="background:#e74c3c">Supprimer</button>
                </form>
              </td>
            </tr>

            <!-- Modal -->
            <div class="modal-overlay" id="team-<%= t.id %>">
              <div class="modal">
                <button class="close-btn" type="button" onclick="closeModal('team-<%= t.id %>')">X</button>
                <h3>Modifier équipe</h3>
                <form method="post" action="/admin/teams/<%= t.id %>/update">
                  <input name="name" value="<%= t.name %>" />
                  <input name="player1_id" value="<%= t.player1_id || '' %>" />
                  <input name="player2_id" value="<%= t.player2_id || '' %>" />
                  <button class="btn">Enregistrer</button>
                </form>
              </div>
            </div>

          <% }) %>
        </tbody>
      </table>
    </section>

    <!-- Gérer les résultats -->
    <section class="card">
      <h2>Résultats</h2>

      <form method="post" action="/admin/results">
        <select name="game_id" required>
          <% games.forEach(g=>{ %>
            <option value="<%= g.id %>"><%= g.name %></option>
          <% }) %>
        </select>
        <select name="team_id" required>
          <% teams.forEach(t=>{ %>
            <option value="<%= t.id %>"><%= t.name %></option>
          <% }) %>
        </select>
        <input type="number" name="score" placeholder="Score" />
        <input type="number" name="points" placeholder="Points" />
        <button class="btn">Ajouter résultat</button>
      </form>

      <table>
        <thead><tr><th>Jeu</th><th>Équipe</th><th>Score</th><th>Points</th><th>Actions</th></tr></thead>
        <tbody>
          <% results.forEach(r=>{ %>
            <tr>
              <td><%= r.game_name %></td>
              <td><%= r.team_name %></td>
              <td><%= r.score %></td>
              <td><%= r.points %></td>
              <td>
                <button class="small-btn" onclick="openModal('result-<%= r.id %>')">Modifier</button>
                <form class="inline-form" method="post" action="/admin/results/<%= r.id %>/delete" onsubmit="return confirm('Supprimer ce résultat ?');">
                  <button class="small-btn" style="background:#e74c3c">Supprimer</button>
                </form>
              </td>
            </tr>

            <!-- Modal -->
            <div class="modal-overlay" id="result-<%= r.id %>">
              <div class="modal">
                <button class="close-btn" type="button" onclick="closeModal('result-<%= r.id %>')">X</button>
                <h3>Modifier résultat</h3>
                <form method="post" action="/admin/results/<%= r.id %>/update">
                  <select name="game_id" required>
                    <% games.forEach(g=>{ %>
                      <option value="<%= g.id %>" <%= g.id===r.game_id?'selected':'' %>><%= g.name %></option>
                    <% }) %>
                  </select>
                  <select name="team_id" required>
                    <% teams.forEach(t=>{ %>
                      <option value="<%= t.id %>" <%= t.id===r.team_id?'selected':'' %>><%= t.name %></option>
                    <% }) %>
                  </select>
                  <input type="number" name="score" value="<%= r.score %>" />
                  <input type="number" name="points" value="<%= r.points %>" />
                  <button class="btn">Enregistrer</button>
                </form>
              </div>
            </div>

          <% }) %>
        </tbody>
      </table>
    </section>

  </main>

  <script>
    function openModal(id){ document.getElementById(id).classList.add('active'); }
    function closeModal(id){ document.getElementById(id).classList.remove('active'); }
  </script>
</body>
</html>
